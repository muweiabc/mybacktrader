<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <title>Experiments Dashboard</title>
  <style>
    body {{ font-family: Arial, sans-serif; margin: 20px; color: #1f2328; background: #f6f8fa; }}
    h1 {{ margin: 0 0 12px; }}
    .panel {{ background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.04); padding: 16px; }}
    .table-wrap {{ overflow: auto; }}
    table {{ border-collapse: collapse; width: 100%; table-layout: fixed; }}
    th, td {{ border: 1px solid #e5e7eb; padding: 8px 10px; text-align: left; vertical-align: top; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }}
    th {{ background: #f3f4f6; position: relative; cursor: pointer; user-select: none; }}
    th.sort-asc::after {{ content: " ▲"; color: #6b7280; font-size: 11px; }}
    th.sort-desc::after {{ content: " ▼"; color: #6b7280; font-size: 11px; }}
    tr:nth-child(even) {{ background: #fafafa; }}
    .resizer {{ position: absolute; right: 0; top: 0; width: 6px; height: 100%; cursor: col-resize; user-select: none; }}
    .filter-input {{ width: 100%; box-sizing: border-box; padding: 6px 8px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 12px; }}
  </style>
</head>
<body>
  <h1>Experiments Dashboard</h1>
  <div class="panel table-wrap">
    {table_html}
  </div>
  <script>
    (function() {{
      const table = document.querySelector('table');
      if (!table) return;
      const thead = table.querySelector('thead');
      const headerRow = thead.querySelector('tr');
      const tbody = table.querySelector('tbody');
      if (!headerRow || !tbody) return;

      const filterRow = document.createElement('tr');
      const headers = Array.from(headerRow.children);

      const getCellText = (row, idx) => {{
        const cell = row.children[idx];
        return cell ? cell.textContent.trim().toLowerCase() : '';
      }};

      const applyFilters = () => {{
        const filters = Array.from(filterRow.querySelectorAll('input')).map((i) => i.value.trim().toLowerCase());
        Array.from(tbody.rows).forEach((row) => {{
          const match = filters.every((value, idx) => {{
            if (!value) return true;
            return getCellText(row, idx).includes(value);
          }});
          row.style.display = match ? '' : 'none';
        }});
      }};

      headers.forEach((th, idx) => {{
        const filterCell = document.createElement('th');
        const input = document.createElement('input');
        input.className = 'filter-input';
        input.type = 'text';
        input.placeholder = 'Filter';
        input.addEventListener('input', applyFilters);
        filterCell.appendChild(input);
        filterRow.appendChild(filterCell);

        const resizer = document.createElement('div');
        resizer.className = 'resizer';
        th.appendChild(resizer);

        let startX = 0;
        let startWidth = 0;
        resizer.addEventListener('mousedown', (e) => {{
          startX = e.pageX;
          startWidth = th.offsetWidth;
          document.body.style.cursor = 'col-resize';
          const onMouseMove = (ev) => {{
            const newWidth = Math.max(60, startWidth + (ev.pageX - startX));
            th.style.width = newWidth + 'px';
            filterCell.style.width = newWidth + 'px';
          }};
          const onMouseUp = () => {{
            document.body.style.cursor = '';
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);
          }};
          document.addEventListener('mousemove', onMouseMove);
          document.addEventListener('mouseup', onMouseUp);
        }});

        th.addEventListener('click', (e) => {{
          if (e.target.classList.contains('resizer')) return;
          headers.forEach((h) => h !== th && h.classList.remove('sort-asc', 'sort-desc'));
          const isAsc = th.classList.toggle('sort-asc');
          th.classList.toggle('sort-desc', !isAsc);

          const rows = Array.from(tbody.rows);
          rows.sort((a, b) => {{
            const aText = a.children[idx]?.textContent.trim() ?? '';
            const bText = b.children[idx]?.textContent.trim() ?? '';
            const aNum = parseFloat(aText.replace(/,/g, ''));
            const bNum = parseFloat(bText.replace(/,/g, ''));
            const bothNumeric = !Number.isNaN(aNum) && !Number.isNaN(bNum);
            if (bothNumeric) {{
              return isAsc ? aNum - bNum : bNum - aNum;
            }}
            const aDate = Date.parse(aText.replace(/-/g, '/'));
            const bDate = Date.parse(bText.replace(/-/g, '/'));
            const bothDate = !Number.isNaN(aDate) && !Number.isNaN(bDate);
            if (bothDate) {{
              return isAsc ? aDate - bDate : bDate - aDate;
            }}
            return isAsc ? aText.localeCompare(bText) : bText.localeCompare(aText);
          }});
          rows.forEach((row) => tbody.appendChild(row));
        }});
      }});

      thead.appendChild(filterRow);
    }})();
  </script>
</body>
</html>
